Date.now||(Date.now=function(){return(new Date).getTime()}),function(){"use strict";for(var t=["webkit","moz"],i=0;i<t.length&&!window.requestAnimationFrame;++i){var e=t[i];window.requestAnimationFrame=window[e+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var s=0;window.requestAnimationFrame=function(t){var i=Date.now(),e=Math.max(s+16,i);return setTimeout(function(){t(s=e)},e-i)},window.cancelAnimationFrame=clearTimeout}}(),function(t){t.snowfall={snowTimeout:0,flakes:[],last:0,random:function(t,i){return t+Math.random()*(i-t)},Flake:function(i,e,s,o,n){var a=t.snowfall.random;this.x=a(e.widthOffset,e.elWidth-e.widthOffset),this.y=a(0,e.elHeight),this.size=s,this.speed=o,this.step=0,this.stepSize=a(1,10)/100,this.id=n,this.group=e,e.options.collection&&(this.target=canvasCollection[a(0,canvasCollection.length-1)]);var h=null;e.options.image?(h=document.createElement("img"),h.src=e.options.image):(h=document.createElement("div"),t(h).css({background:e.options.flakeColor})),t(h).attr({"class":"snowfall-flakes"}).css({width:this.size,height:this.size,position:e.options.flakePosition,top:this.y,left:this.x,fontSize:0,zIndex:e.options.flakeIndex}).data("snowfall-id",this.id),t(i).get(0).tagName===t(document).get(0).tagName?(t("body").append(t(h)),i=t("body")):t(i).append(t(h)),this.element=h,this.update=function(t){var i=t/(1/this.group.options.fps*1e3);if(this.y+=this.speed*i,this.y>this.group.elHeight-(this.size+6)&&this.reset(),this.element.style.top=this.y+"px",this.element.style.left=this.x+"px",this.step+=this.stepSize*i,this.x+=this.group.doRatio===!1?Math.cos(this.step)*i:(this.group.doRatio+Math.cos(this.step))*i,this.group.options.collection&&this.x>this.target.x&&this.x<this.target.width+this.target.x&&this.y>this.target.y&&this.y<this.target.height+this.target.y){var e=this.target.element.getContext("2d"),s=this.x-this.target.x,o=this.y-this.target.y,n=this.target.colData;if(void 0!==n[parseInt(s)][parseInt(o+this.speed+this.size)]||o+this.speed+this.size>this.target.height)if(o+this.speed+this.size>this.target.height){for(;o+this.speed+this.size>this.target.height&&this.speed>0;)this.speed*=.5;e.fillStyle="#fff",void 0==n[parseInt(s)][parseInt(o+this.speed+this.size)]?(n[parseInt(s)][parseInt(o+this.speed+this.size)]=1,e.fillRect(s,o+this.speed+this.size,this.size,this.size)):(n[parseInt(s)][parseInt(o+this.speed)]=1,e.fillRect(s,o+this.speed,this.size,this.size)),this.reset()}else this.speed=1,this.stepSize=0,parseInt(s)+1<this.target.width&&void 0==n[parseInt(s)+1][parseInt(o)+1]?this.x++:parseInt(s)-1>0&&void 0==n[parseInt(s)-1][parseInt(o)+1]?this.x--:(e.fillStyle="#fff",e.fillRect(s,o,this.size,this.size),n[parseInt(s)][parseInt(o)]=1,this.reset())}(this.x+this.size>this.group.elWidth-this.group.widthOffset||this.x<this.group.widthOffset)&&this.reset()},this.reset=function(){this.y=0,this.x=a(this.group.widthOffset,this.group.elWidth-this.group.widthOffset),this.stepSize=a(1,10)/100,this.size=a(100*e.options.minSize,100*e.options.maxSize)/100,this.element.style.width=this.size+"px",this.element.style.height=this.size+"px",this.speed=a(e.options.minSpeed,e.options.maxSpeed)}},fall:function(i,e){var s={flakeCount:35,flakeColor:"#ffffff",flakePosition:"absolute",flakeIndex:999999,minSize:1,maxSize:2,minSpeed:1,maxSpeed:5,fps:30,round:!1,shadow:!1,scale:!0,collection:!1,collectionHeight:40,deviceorientation:!1};if(this.options=t.extend(s,e),t(i).data("snowfall",this),this.elHeight=t(i).height(),this.elWidth=t(i).width(),this.widthOffset=0,this.doRatio=!1,this.options.collection!==!1){var o=document.createElement("canvas");if(o.getContext&&o.getContext("2d"))for(var n=[],a=t(this.options.collection),h=this.options.collectionHeight,l=0;l<a.length;l++){var r=a[l].getBoundingClientRect(),d=t("<canvas/>",{"class":"snowfall-canvas"}),f=[];if(r.top-h>0){t("body").append(d),d.css({position:this.options.flakePosition,left:r.left+"px",top:r.top-h+"px"}).prop({width:r.width,height:h});for(var p=0;p<r.width;p++)f[p]=[];n.push({element:d.get(0),x:r.left,y:r.top-h,width:r.width,height:h,colData:f})}}else this.options.collection=!1}t(i).get(0).tagName===t(document).get(0).tagName&&(this.widthOffset=25);var c=this;for(t(window).bind("resize",function(){setTimeout(function(){if(c.elHeight=t(i)[0].clientHeight,c.options.scale===!0&&c.elWidth!==t(i)[0].offsetWidth){var e=t(i)[0].offsetWidth/c.elWidth;t(i).children(".snowfall-flakes").each(function(){var i=t(this).data("snowfall-id");t.each(t.snowfall.flakes,function(t,s){return s.id==i?(s.x=s.x*e,!1):void 0})})}c.elWidth=t(i)[0].offsetWidth},100)}),l=0;l<this.options.flakeCount;l+=1)t.snowfall.addFlake(i,this);this.options.round&&t(".snowfall-flakes").css({"-moz-border-radius":this.options.maxSize,"-webkit-border-radius":this.options.maxSize,"border-radius":this.options.maxSize}),this.options.shadow&&t(".snowfall-flakes").css({"-moz-box-shadow":"1px 1px 1px #555","-webkit-box-shadow":"1px 1px 1px #555","box-shadow":"1px 1px 1px #555"}),this.options.deviceorientation&&t(window).bind("deviceorientation",function(t){doRatio=.1*t.originalEvent.gamma}),t.snowfall.start(),this.clear=function(){t(".snowfall-canvas").remove(),t(i).children(".snowfall-flakes").remove(),t.snowfall.removeFlakes(i),t.snowfall.stop()}},addFlake:function(i,e){var s=0;t.each(this.flakes,function(t,i){return i.id==s&&s++,i.id>s?!1:void 0}),this.flakes.push(new this.Flake(i,e,this.random(100*e.options.minSize,100*e.options.maxSize)/100,this.random(e.options.minSpeed,e.options.maxSpeed),s)),this.flakes.sort(function(t,i){return t.id-i.id})},removeFlakes:function(i){var e=this.flakes.slice();t.each(this.flakes,function(s,o){t(i).children(".snowfall-flakes").each(function(){t(this).data("snowfall-id")===o.id&&t.each(e,function(t,i){return o.id==i.id?(e.splice(t,1),!1):void 0})})}),e.sort(function(t,i){return t.id-i.id}),this.flakes=e},snow:function(e){for(i=0;i<this.flakes.length;i+=1)this.flakes[i].update(e-this.last);this.last=e,this.snowTimeout=requestAnimationFrame(function(i){t.snowfall.snow(i)})},start:function(){this.snowTimeout||(this.snowTimeout=requestAnimationFrame(function(i){t.snowfall.snow(i)}))},stop:function(){this.flakes.length||cancelAnimationFrame(this.snowTimeout)}},t.fn.snowfall=function(i){return"object"==typeof i||void 0==i?this.each(function(){new t.snowfall.fall(this,i)}):"string"==typeof i?this.each(function(){var i=t(this).data("snowfall");i&&i.clear()}):void 0}}(jQuery);